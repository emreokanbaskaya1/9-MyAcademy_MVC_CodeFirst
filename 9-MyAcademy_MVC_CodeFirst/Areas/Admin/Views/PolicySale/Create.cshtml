@model _9_MyAcademy_MVC_CodeFirst.Data.Entities.PolicySale
@{
    ViewBag.Title = "New Policy Sale";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<div class="mb-6">
    <a href="@Url.Action("Index")" class="inline-flex items-center gap-2 text-gray-500 hover:text-primary dark:text-gray-400 dark:hover:text-primary transition-colors">
        <span class="material-icons-outlined text-lg">arrow_back</span>
        <span>Back to Policy Sales</span>
    </a>
</div>

<div class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-gray-200 dark:border-surface-border overflow-hidden">
    @using (Html.BeginForm("Create", "PolicySale", FormMethod.Post, new { @class = "p-6" }))
    {
        @Html.AntiForgeryToken()
        @Html.ValidationSummary(true, "", new { @class = "text-rose-500 text-sm mb-4" })

        <!-- Customer Information Section -->
        <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                <span class="material-icons-outlined text-primary">person</span>
                Customer Information
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">First Name *</label>
                    @Html.TextBoxFor(m => m.FirstName, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", placeholder = "Enter first name" })
                    @Html.ValidationMessageFor(m => m.FirstName, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Last Name *</label>
                    @Html.TextBoxFor(m => m.LastName, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", placeholder = "Enter last name" })
                    @Html.ValidationMessageFor(m => m.LastName, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address *</label>
                    @Html.TextBoxFor(m => m.Email, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", placeholder = "example@email.com", type = "email" })
                    @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone Number *</label>
                    @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", placeholder = "+90 5XX XXX XX XX" })
                    @Html.ValidationMessageFor(m => m.PhoneNumber, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">TC Identity Number</label>
                    @Html.TextBoxFor(m => m.TCIdentityNumber, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", placeholder = "XXXXXXXXXXX", maxlength = "11" })
                    @Html.ValidationMessageFor(m => m.TCIdentityNumber, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Address</label>
                    @Html.TextBoxFor(m => m.Address, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", placeholder = "Enter address" })
                    @Html.ValidationMessageFor(m => m.Address, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
            </div>
        </div>

        <!-- Policy Information Section -->
        <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                <span class="material-icons-outlined text-primary">description</span>
                Policy Information
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Select Policy *</label>
                    @Html.DropDownListFor(m => m.ProductId, ViewBag.Products as IEnumerable<SelectListItem>, "-- Select Policy --", new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", id = "ProductId" })
                    @Html.ValidationMessageFor(m => m.ProductId, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Sale Amount *</label>
                    <div class="relative">
                        <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">?</span>
                        @Html.TextBoxFor(m => m.SaleAmount, new { @class = "w-full pl-8 pr-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", id = "SaleAmount", type = "number", step = "0.01" })
                    </div>
                    @Html.ValidationMessageFor(m => m.SaleAmount, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Policy Start Date *</label>
                    @Html.TextBoxFor(m => m.PolicyStartDate, "{0:yyyy-MM-dd}", new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", type = "date" })
                    @Html.ValidationMessageFor(m => m.PolicyStartDate, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Policy End Date *</label>
                    @Html.TextBoxFor(m => m.PolicyEndDate, "{0:yyyy-MM-dd}", new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", type = "date" })
                    @Html.ValidationMessageFor(m => m.PolicyEndDate, "", new { @class = "text-rose-500 text-xs mt-1" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Status</label>
                    @Html.DropDownListFor(m => m.PaymentStatus, new SelectList(Enum.GetValues(typeof(_9_MyAcademy_MVC_CodeFirst.Data.Entities.PaymentStatus))), new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent" })
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Policy Status (Optional)</label>
                    <div class="space-y-2">
                        <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                            <p class="text-xs text-blue-700 dark:text-blue-300">
                                <span class="material-icons-outlined text-sm align-middle">info</span>
                                <strong>Auto-calculated:</strong> Status will be automatically set based on start/end dates. Only override if you need to manually set Cancelled or Suspended.
                            </p>
                        </div>
                        <select name="manualStatus" class="w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Auto (Based on Dates)</option>
                            <option value="Cancelled">Cancelled (Manual)</option>
                            <option value="Suspended">Suspended (Manual)</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="mb-8">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                <span class="material-icons-outlined text-primary">notes</span>
                Additional Notes
            </h3>
            <div>
                @Html.TextAreaFor(m => m.Notes, new { @class = "w-full px-4 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border bg-white dark:bg-surface-dark text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent", rows = "4", placeholder = "Add any additional notes about this policy sale..." })
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="flex items-center justify-end gap-4 pt-6 border-t border-gray-200 dark:border-surface-border">
            <a href="@Url.Action("Index")" class="px-6 py-2.5 rounded-lg border border-gray-300 dark:border-surface-border text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-surface-border transition-colors">
                Cancel
            </a>
            <button type="submit" class="px-6 py-2.5 rounded-lg bg-primary hover:bg-primary-hover text-white font-medium shadow-lg shadow-primary/20 flex items-center gap-2 transition-colors">
                <span class="material-icons-outlined text-lg">save</span>
                Create Policy Sale
            </button>
        </div>
    }
</div>

@section scripts {
    <script>
        document.getElementById('ProductId').addEventListener('change', function() {
            var productId = this.value;
            if (productId) {
                fetch('@Url.Action("GetProductPrice", "PolicySale")' + '?productId=' + productId)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            document.getElementById('SaleAmount').value = data.price;
                        }
                    });
            }
        });
    </script>
}
